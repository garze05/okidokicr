---
export const prerender = false;
import AdminLayout from "../../../../layouts/AdminLayout.astro";
import ProtectedRoute from "@components/admin/layout/ProtectedRoute.jsx";
import EditService from "@components/admin/services/EditService.jsx";

const apiUrl = import.meta.env.PUBLIC_API_URL;
const { id } = Astro.params;

// Fetch the specific service to edit
let service, allTags;
try {
  const serviceRes = await fetch(`${apiUrl}/services/${id}`);
  if (!serviceRes.ok)
    throw new Error(
      `Servicio ${id} no encontrado. Status: ${serviceRes.status}`,
    );
  service = await serviceRes.json();

  // Fetch all tags for the form
  const tagsRes = await fetch(`${apiUrl}/tags`);
  if (!tagsRes.ok)
    throw new Error(`Error al cargar las etiquetas. Status: ${tagsRes.status}`);
  allTags = await tagsRes.json();
} catch (error) {
  console.error("Error fetching data for service edit page:", error);
  // Redirect to a 404 or error page if data isn't found or on error
  return Astro.redirect("/404"); // Or a more specific error page
}
---

<AdminLayout
  title={`Editar ${service.title}`}
  description="Panel de control para administrar el sitio web de OkiDoki."
>
  <ProtectedRoute client:load>
    <EditService service={service} allTags={allTags} client:load />
  </ProtectedRoute>
</AdminLayout>

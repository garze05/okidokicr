---
import "../styles/global.css";
import MainLayout from "../layouts/MainLayout.astro";
---

<MainLayout title="Subir Medios">
  <h1>Subir Foto o Video</h1>
  <form id="upload-form">
    <input type="file" name="file" required />
    <button type="submit">Subir</button>
  </form>

  <script>
    document
      .getElementById('upload-form')
      .addEventListener('submit', async (e) => {
        e.preventDefault();
        const token = localStorage.getItem('token');
        if (!token) {
          alert('Debes iniciar sesión');
          return window.location.href = '/login';
        }

        const formData = new FormData(e.target);
        const res = await fetch('http://localhost:4000/api/upload', {
          method: 'POST',
          headers: {
            Authorization: `Bearer ${token}`
          },
          body: formData
        });

        if (res.ok) {
          const { url } = await res.json();
          alert('¡Subida exitosa! URL: ' + url);
        } else if (res.status === 401) {
          alert('Tu sesión expiró. Por favor inicia sesión de nuevo.');
          window.location.href = '/login';
        } else {
          const { error } = await res.json();
          alert('Error: ' + error);
        }
      });
  </script>
</MainLayout>
